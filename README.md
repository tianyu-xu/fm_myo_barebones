# Electromyogaphy-based Mouse Pointer Control with Python

## Abstract

As people become more and more integrated with the personal computers, smartphones, cloud services and various embedded systems, new interfacing options are required to provide faster and more comfortable service than a conventional touchscreen, button or a mouse. One of the possible ways to realize human-machine interface is via electromyographic signals, which are generated by muscles during their contractions and can be analyzed to derive the command to the computer. This technology has applications in prosthetics and rehabilitation as well.<p>

The purpose of the project is to implement a Python-based program that allows the user to control the mouse cursor by contracting the muscles of his hand. A software is designed to acquire EMG signals from the MYO EMG armband using Python. A GUI is established to guide the user through the calibration procedure. The user is asked to reach a specific point and the time he needs to reach is measured. His experience is evaluated if there is a learning curve and how fast the skill grows with training. Create a simple Python-based GUI to show the user the position of the pointer. Guide the user through the calibration process. Set up challenging tasks. Analyze their experience. Try to assess whether there is a learning curve and how fast your skills will grow after training.

## Requirements

### Software packages

* OS: Windows 10 <p>

* Languages: Python 3<p>

* Dependancies: numpy, matplotlib, PyAutoGUI, scipy, myopython

### Hardware

* Components: MYO EMG armband

## Installation and setup

### 0. Install Anaconda
If you are not familiar with Python and virtual environments, I suggest using Anaconda. Download a Python 3.7 Anaconda from the [official site](https://www.anaconda.com/products/individual)
and install it. Use default installation options.

### 1. Install MyoConnect

Install MyoConnect from the provided setup file: [Windows](https://www.dropbox.com/s/2dfv0gpqq0c2qrp/Myo_Connect_Installer.exe?dl=0)
, [MacOS](https://www.dropbox.com/s/ua43z9n2rib4hv3/MyoConnect.dmg?dl=0)
.

To connect and use the armband, please follow the official tutorial within MyoConnect.

Later, to set up MyoConnect for a comfortable work, run it, then right-click on its icon in task bar, select **Preferences**, and uncheck all options in all tabs. Then, right-click on icon again, select **Application Manager** and uncheck all options here too.

### 2. Create a new python 3.8 virtual environment (explained for Anaconda)

On Windows, open **anaconda prompt**. On MacOS, run **Terminal**. Run the following commands and accept the changes:
```
conda create --name myo python=3.8 pip
```
Now activate the environment that we have just created (its name is '*myo*'):
```
conda activate myo
```
Note: please remember that any time you want to run this project from a new command/terminal window, you need to activate this environment again.

### 3. Install *myo-python* package

Install it from from our fork on Github. To do so, in command line, with 'myo' environment activated, run:
```
pip install https://github.com/smetanadvorak/myo-python/tarball/master
```
### 4. Setup the fm_myo_barebones package

[Download](https://github.com/smetanadvorak/fm_myo_barebones/tarball/master)
this project and put it in an appropriate directory on your disk. In command window, navigate to this project's folder and run:
```
pip install -e .
```


## Introduction

### Research Status
In 1780, the Italian biologist Galvani accidentally discovered the phenomenon of "dead frog movement", that is, when the exposed nerves of the frog's legs were killed with the tip of a knife, the dead frog was trembling. He published his exposition on "animal electricity" in the thesis "On the Electricity in Muscles" in 1792. Since then, he has laid the foundation for the study of bioelectricity and proved that muscle contraction is related to electricity.

In 2013, Canadian startup Thalmic Labs launched an innovative armband MYO wristband (gesture control armband). This gesture control armband can be worn above the elbow joint of any arm to detect electrical activity generated by the user's muscles. It wirelessly connects with other electronic products through low-power Bluetooth devices to sense the user's actions. The MYO armband is composed of 8 muscle pulse detection modules, with metal contacts on the inside to detect muscle pulses close to the arm. The Myo bracelet device and wearing method are shown in the figure.

![myo_band](https://github.com/tianyu-xu/fm_myo_barebones/blob/master/docs/myo_band.png)

The characteristic abbreviations of commonly used EMG signals correspond to the following table. Hudgins proposed a feature set, which is composed of mean absolute value (MAV), zero crossing rate (ZC), slope sign change (SSC) and waveform length (WL). This feature set is a feature set in the time domain that can be applied to classification. Englehart tested some time-frequency domain sets (WF, WT and WPT). The experimental results only in the classification show that the time-domain feature set is better than the time-frequency domain set. Jiang uses the root mean square value (MSV) to estimate the force. Fougner evaluated multiple combinations of 15 different EMG functions in order to estimate the joint angle. Research has found that there are differences between each, and using a specific feature set for a specific user will produce the best results.

![Abbreviation](https://github.com/tianyu-xu/fm_myo_barebones/blob/master/docs/abbr.png)

### Physiological Basis of EMG Signal Generation

The problem of muscles producing bioelectrical signals is, from the forward perspective, how specific mechanisms and phenomena affect the signal, and the reverse problem is how the signal reflects certain mechanisms and phenomena and allows them to be identified and described.

The central nervous system is organized in a hierarchical manner. The exercise program is organized in the pre-exercise cortex, auxiliary motor area and other related areas of the cortex. The anterior motor cortex is located on the outer side of the cerebral hemisphere, and the auxiliary motor cortex is located on the dorsal side of the anterior motor area and extends to the inner side of the hemisphere. The premotor cortex is the primary motor cortex of the frontal lobe of the brain, which is composed of the interconnected areas of the cerebral hemispheres. The cerebellum and, to a certain extent, the input from the basal ganglia (stimulating or inhibiting) neurons of the primary motor cortex, the brainstem and the spinal cord.

Motor Unit (Motor Unit) is the α-motor neuron in the spinal cord (the sum of all descending and reflex inputs) and the muscle fibers it innervates. According to physiological characteristics (such as contraction speed and fatigue (sensitivity to fatigue)), three types of motor units can be identified: (1) rapid twitching and fatigue (type FF or IIb); (2) fast bending , Fatigue resistance (FR or IIa type); (3) Slow twitching (S or I type), the most fatigue resistant.

Analyze the contraction characteristics of different types of muscle fibers from the way to generate ATP for muscle activity and its metabolic byproducts. From the perspective of single fiber action potential and MU action potential characteristics, compared with type I fibers, type II fibers It has more negative resting potential, greater peak excursion, faster rate of depolarization and repolarization, and shortened action potential duration.

The principle diagram of the basic motor unit control mechanism is shown in the figure. The whole process follows this process: the input from the cerebellum, and to some extent the input from the basal ganglia (stimulation or inhibition), to the neurons in the primary motor cortex, Then to the brain stem and spinal cord. Then, the connection between the corticospinal tract and α-motor neurons provides direct cortical control of muscle activity.

![Schematic diagram of basic motion unit control mechanism](https://github.com/tianyu-xu/fm_myo_barebones/blob/master/docs/BIO.png)

In spontaneous muscle contraction, strength is regulated by a combination of motor unit (MU) contraction and activation frequency (rate encoding) changes. The stronger the contraction, the higher the activation frequency, and the greater the strength; 3 It has nothing to do with the type of muscle, gender, age and training status.

Motor units are always recruited in increasing order of α-motor neuron size. There is a positive correlation between the recruitment order of a single MU, peak amplitude and twitch tension, AKA "normal recruitment sequence" or "orderly recruitment". The recruitment and firing frequency (rate coding) of the motor unit mainly depends on the size of the force and the speed of contraction. The number of MU recruited and its average firing frequency determine the electrical activity in the muscle, that is, the same factors determine muscle strength. Therefore, a direct relationship between electromyography (EMG) and applied force can be expected.

### Gesture Selection and Experimental Equipment Preparation

#### 1. Gesture selection

In order to determine the gesture indicating the movement of the cursor, the EMG signal generated by the movement of the wrist is studied. The wrist is a series of complex joints, formed around the carpal bones, fin spoke bones and ulna (forearm bones). The wrist can perform three different sets of movements:

(1) Flexion and extension;

(2) Supination and pronation;

(3) Ulnar deviation (ulnar flexion) and radial deviation (radial flexion).

Among them, flexion describes the action of bending the palm downward toward the wrist, and extension describes the action of raising the back of the hand; pronation describes the action of rotating the forearm to the palm-up position, and supination describes the motion of rotating the forearm to the palm-down position. Movement; Ulnar deviation refers to the movement of the wrist to the little finger or the ulna side; the fin deviation is the movement of bending the wrist to the thumb side, as shown in the figure below.

![Gestures](https://github.com/tianyu-xu/fm_myo_barebones/blob/master/docs/gesture.png)

#### 2. Preparation of test equipment

The surface EMG signal can be measured with wet electrodes and dry electrodes. Commonly used wet electrodes need to add conductive electrolyte gel or sponge between the electrode and the skin, but they can provide high-quality surface EMG signals. Wet electrodes usually require shaving or wiping treatment on the skin surface, which can reduce skin electrode impedance and movement artifacts. However, wet electrodes may not be suitable for long-term use at the surface EMG interface, because the drying of the conductive gel can cause irritation and cause skin discomfort, and potentially cause skin allergies and inflammation. However, modern dry electrodes do not require conductive gel and skin pretreatment, and can still achieve signal quality comparable to wet electrodes. Therefore, dry electrodes may be more suitable for surface EMG interfaces.

The material of the electrode affects its electrochemical behavior. Polarized electrodes (such as gold, platinum and iridium electrodes) are characterized by capacitive behavior, because only displacement current passes between the skin and the electrodes; non-polarized electrodes (such as zinc-plated and Ag/AgCl electrodes) exhibit resistive properties , Because they allow charge to flow freely at the electrode-skin interface. The commonly used non-polarized silver-silver chloride (Ag/AgCl) electrode consists of a silver metal surface plated with a thin layer of silver chloride, which is highly stable. In order to better receive the EMG signal, it is recommended that the bipolar surface EMG channel should be placed in the transmission part of the muscle, in the endplate area, that is, between the innervation area and the tendon area. From the generation of the surface EMG signal to the detection by the electrodes, it passes through human tissue structures such as the dermis and subcutaneous tissue, epidermal stratum corneum, conductive paste, or skin exudate in turn.

This experiment uses the myo bracelet developed by Thalmic Labs as the test equipment. This gesture control armband can be worn above the elbow joint of any arm to detect electrical activity generated by the user's muscles. It wirelessly connects with other electronic products through low-power Bluetooth devices to sense the user's actions. The MYO armband is composed of 8 muscle pulse detection modules, with metal contacts on the inside to detect muscle pulses close to the arm.

### Support Vector Machine

Support Vector Machine (SVM) is a type of generalized linear classifier that performs binary classification of data according to supervised learning. As the classifier model of this research, a support vector machine (SVM) with a round-based kernel function (RBF) is applied.

(1) Basic principles of support vector machines

(2) Linearly separable

Detailed knowledge of SVM can be seen [here](https://zhuanlan.zhihu.com/p/77750026).



## Architecture

The main research plan of this graduation project is shown in Figure below.

![Main Research Plan](https://github.com/tianyu-xu/fm_myo_barebones/blob/master/docs/MainResearchProgram.JPG)



### Step 1: MAV
Apply the calculation of MAV (mean absolute value) for all eight channels of the EMG using MYO armband. Plotted the calculated value. Find out which channels may be of use to control a pointer in each of the directions.



### Step 2: Make a Prototype cursor control example
1. Find out which channels help you detect these movements of the wrist (see terms and descriptions [here]( http://www.ergovancouver.net/wrist_movements.htm)).
2. Implement a MAV calculator in these channels, using the same IIR filter approach.
3. Find a python package that lets you control the mouse cursor (probably you will end up using [pyautogui]( https://pypi.org/project/PyAutoGUI/)).
4. Map the MAV in each of the four channels to the speed of cursor in the corresponding direction.
5. Make a video of how it works. Can you freely navigate with this design? Is it stable? How would you implement a mouse click?


##  Examples
### 0. How to Run the Code

#### 1. Set up MyoConnect
This should be done only once at the beginning of your working session:

* Insert MYO's Bluetooth dongle in your USB port.
* Run MyoConnect, right-click on its icon in task bar, select **Armband Manager** ....
* Approach the dongle with your armband. It should automatically get paired with MyoConnect.
* In MyoConnect, press 'Ping' to make sure that it is not connected to some other armband nearby. Your armband should vibrate in response to the ping.

#### 2. Setup the environment and run the code

Open **Anaconda Prompt** (Windows) or **Terminal** (MacOS) and activate the 'myo' environment:
```
conda activate myo
```
Navigate to the folder with this package, then to ./examples/streaming and run a test script:
```
python streaming.py
```
If everything is installed correctly, a matplotlib figure should appear with the EMG signals being traced in real time. This and other examples can be stopped by either pressing **ctrl-c** (MacOS) or **shift-c** (Windows).phy-based Mouse Pointer Control with Python

## Abstract

As people become more and more integrated with the personal computers, smartphones, cloud services and various embedded systems, new interfacing options are required to provide faster and more comfortable service than a conventional touchscreen, button or a mouse. One of the possible ways to realize human-machine interface is via electromyographic signals, which are generated by muscles during their contractions and can be analyzed to derive the command to the computer. This technology has applications in prosthetics and rehabilitation as well.<p>

The purpose of the project is to implement a Python-based program that allows the user to control the mouse cursor by contracting the muscles of his hand. A software is designed to acquire EMG signals from the MYO EMG armband using Python. A GUI is established to guide the user through the calibration procedure. The user is asked to reach a specific point and the time he needs to reach is measured. His experience is evaluated if there is a learning curve and how fast the skill grows with training.

## Requirements

### Software packages

* OS: Windows 10 <p>

* Languages: Python 3<p>

* Dependancies: numpy, matplotlib, PyAutoGUI, scipy, myopython

### Hardware

* Components: MYO EMG armband

## Installation and setup

### 0. Install Anaconda
If you are not familiar with Python and virtual environments, I suggest using Anaconda. Download a Python 3.7 Anaconda from the [official site](https://www.anaconda.com/products/individual)
and install it. Use default installation options.

### 1. Install MyoConnect

Install MyoConnect from the provided setup file: [Windows](https://www.dropbox.com/s/2dfv0gpqq0c2qrp/Myo_Connect_Installer.exe?dl=0)
, [MacOS](https://www.dropbox.com/s/ua43z9n2rib4hv3/MyoConnect.dmg?dl=0)
.

To connect and use the armband, please follow the official tutorial within MyoConnect.

Later, to set up MyoConnect for a comfortable work, run it, then right-click on its icon in task bar, select **Preferences**, and uncheck all options in all tabs. Then, right-click on icon again, select **Application Manager** and uncheck all options here too.

### 2. Create a new python 3.8 virtual environment (explained for Anaconda)

On Windows, open **anaconda prompt**. On MacOS, run **Terminal**. Run the following commands and accept the changes:
```
conda create --name myo python=3.8 pip
```
Now activate the environment that we have just created (its name is '*myo*'):
```
conda activate myo
```
Note: please remember that any time you want to run this project from a new command/terminal window, you need to activate this environment again.

### 3. Install *myo-python* package

Install it from from our fork on Github. To do so, in command line, with 'myo' environment activated, run:
```
pip install https://github.com/smetanadvorak/myo-python/tarball/master
```
### 4. Setup the fm_myo_barebones package

[Download](https://github.com/smetanadvorak/fm_myo_barebones/tarball/master)
this project and put it in an appropriate directory on your disk. In command window, navigate to this project's folder and run:
```
pip install -e .
```


## Architecture

### Step 1: MAV
Apply the calculation of MAV (mean absolute value) for all eight channels of the EMG using MYO armband. Plotted the calculated value. Find out which channels may be of use to control a pointer in each of the directions.

### Step 2: Make a Prototype cursor control example
1. Find out which channels help you detect these movements of the wrist (see terms and descriptions [here]( http://www.ergovancouver.net/wrist_movements.htm)).
2. Implement a MAV calculator in these channels, using the same IIR filter approach.
3. Find a python package that lets you control the mouse cursor (probably you will end up using [pyautogui]( https://pypi.org/project/PyAutoGUI/)).
4. Map the MAV in each of the four channels to the speed of cursor in the corresponding direction.
5. Make a video of how it works. Try to freely navigate with this design stably. Make a fist to implement a mouse click.

### Step 3: Gesture Classification
If the result of step 2 is not good enough, then try to use SVM to implement pointer control. The first step is acquiring training set and training the classifier. The second phase included the online validation of the gesture classification. The result of classification will be connected to the cursor.

### Step 4: Design a Game with EMG cursor



##  Examples
### 0. How to Run the Code

#### 1. Set up MyoConnect
This should be done only once at the beginning of your working session:

* Insert MYO's Bluetooth dongle in your USB port.
* Run MyoConnect, right-click on its icon in task bar, select **Armband Manager** ....
* Approach the dongle with your armband. It should automatically get paired with MyoConnect.
* In MyoConnect, press 'Ping' to make sure that it is not connected to some other armband nearby. Your armband should vibrate in response to the ping.

#### 2. Setup the environment and run the code

Open **Anaconda Prompt** (Windows) or **Terminal** (MacOS) and activate the 'myo' environment:
```
conda activate myo
```
Navigate to the folder with this package, then to ./examples/streaming and run a test script:
```
python streaming.py
```
If everything is installed correctly, a matplotlib figure should appear with the EMG signals being traced in real time. This and other examples can be stopped by either pressing **ctrl-c** (MacOS) or **shift-c** (Windows).